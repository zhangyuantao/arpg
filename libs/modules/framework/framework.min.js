var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r["throw"](e))}catch(t){a(t)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,a&&(i=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,a=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(i=c.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){c.label=n[1];break}if(6===n[0]&&c.label<i[1]){c.label=i[1],i=n;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(n);break}i[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(r){n=[6,r],a=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,a,i,s,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},GameObject=function(e){function t(){var t=e.call(this)||this;return t.key="gameObject",t}return __extends(t,e),t.prototype.onCreate=function(){},t.prototype.onDestroy=function(){},t.prototype.onEnterFrame=function(e){},t}(egret.HashObject);__reflect(GameObject.prototype,"GameObject");var UI;!function(e){var t=function(t){function n(e){var n=t.call(this)||this,r=n;return r.data=e,r.touchEnabled=!0,r.once(egret.Event.ADDED_TO_STAGE,r.onEnter,r),r.once(egret.Event.REMOVED_FROM_STAGE,r.onDestroy,r),r.onCreate(),n}return __extends(n,t),n.show=function(t){var n=this,r=n.name,o=new n(t);return o.key=r,o.show(),e.uiManager.add(o),o},n.prototype.onCreate=function(){},n.prototype.onEnter=function(){},n.prototype.onDestroy=function(){var e=this;e.data=null,console.log(e.key+"->destroy")},n.prototype.show=function(){var e=this;e.visible||(e.visible=!0)},n.prototype.close=function(t){void 0===t&&(t=!0);var n=this;n.visible&&(n.visible=!1),t&&e.uiManager.remove(n)},n.prototype.pause=function(){var e=this;e.isPause=!0,console.log("pause")},n.prototype.resume=function(){var e=this;e.isPause=!1,console.log("resume")},n}(egret.Sprite);e.SpriteUIBase=t,__reflect(t.prototype,"UI.SpriteUIBase",["UI.IUI"])}(UI||(UI={}));var SingletonClass=function(){function e(){}return e.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;return n.instance||(n.instance=new n(e)),n.instance},e}();__reflect(SingletonClass.prototype,"SingletonClass");var UI;!function(e){var t=function(t){function n(e){var n=t.call(this)||this,r=n,o=Utils.getClassName(r);return r.skinName=o.slice(o.lastIndexOf(".")+1)+"Skin",r.data=e,r.onCreate(),r.once(egret.Event.ADDED_TO_STAGE,r.onEnter,r),r.once(egret.Event.REMOVED_FROM_STAGE,r.onDestroy,r),n}return __extends(n,t),n.show=function(t){var n=this,r=n.name,o=new n(t);return o.key=r,o.show(),e.uiManager.add(o),o},n.prototype.onCreate=function(){},n.prototype.onEnter=function(){},n.prototype.show=function(){var e=this;e.visible||(e.visible=!0)},n.prototype.close=function(t){void 0===t&&(t=!0);var n=this;n.visible&&(n.visible=!1),t&&e.uiManager.remove(n)},n.prototype.onDestroy=function(){var e=this;e.data=null,console.log(e.key+"->destroy")},n.prototype.pause=function(){var e=this;e.isPause=!0,console.log("pause")},n.prototype.resume=function(){var e=this;e.isPause=!1,console.log("resume")},n}(eui.Component);e.SkinUIBase=t,__reflect(t.prototype,"UI.SkinUIBase",["UI.IUI"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.SkinUIBase);e.MsgUI=t,__reflect(t.prototype,"UI.MsgUI")}(UI||(UI={}));var ObjectPool=function(){function e(){this._pool={},this._list=[],egret.Ticker.getInstance().register(this.onEnterFrame,this)}return e.prototype.onEnterFrame=function(e){for(var t=this._list.concat(),n=0,r=t.length;r>n;n++){var o=t[n];o.onEnterFrame(e)}},e.prototype.createObject=function(e){var t,n=e.key,r=this._pool[n];return null!=r&&r.length?t=r.shift():(t=new e,t.key=n),t.onCreate(),this._list.push(t),t},e.prototype.destroyObject=function(e){var t=e.key;null==this._pool[t]&&(this._pool[t]=[]),this._pool[t].push(e),e.onDestroy();var n=this._list.indexOf(e);-1!=n&&this._list.splice(n,1)},e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e}();__reflect(ObjectPool.prototype,"ObjectPool");var State=function(){function e(){}return e.prototype.onEnter=function(){},e.prototype.onExit=function(){},e}();__reflect(State.prototype,"State");var StateMachine=function(){function e(){}return e.prototype.change=function(e){this._state&&this._state.onExit(),this._state=e,this._state.onEnter()},e}();__reflect(StateMachine.prototype,"StateMachine");var Res;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onProgress=function(e,t){this.loadingTxt.text="Loading..."+e+"/"+t},t}(UI.SkinUIBase);e.LoadingResDlg=t,__reflect(t.prototype,"Res.LoadingResDlg",["RES.PromiseTaskReporter"])}(Res||(Res={}));var Res;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onCreate=function(){e.prototype.onCreate.call(this),this.createView()},t.prototype.createView=function(){var e=this;e.textField=new egret.TextField,e.addChild(e.textField),e.textField.y=300,e.textField.width=Utils.StageUtils.stageWidth,e.textField.height=100,e.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(UI.SpriteUIBase);e.PreloadingUI=t,__reflect(t.prototype,"Res.PreloadingUI",["RES.PromiseTaskReporter"])}(Res||(Res={}));var Res;!function(e){var t=function(){function t(){if(t.instance)throw"ResMgr instance already constructed!"}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.loadGroup=function(t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n=e.LoadingResDlg.show(),[4,RES.loadGroup(t,0,n)];case 1:return r.sent(),n.close(),[2]}})})},t}();e.ResMgr=t,__reflect(t.prototype,"Res.ResMgr")}(Res||(Res={}));var Scene;!function(e){var t=function(t){function n(e){var n=t.call(this)||this,r=n;return r.data=e,r.onCreate(),n}return __extends(n,t),n.run=function(t,n,r){void 0===t&&(t={}),void 0===n&&(n=!1),void 0===r&&(r=!0);var o=this;return e.sceneMgr.run(o.name,o,t,n,r)},n.prototype.onCreate=function(){var e=this;e.layerMap={},e.uiStackMap={},e.initLayer()},n.prototype.initLayer=function(e){void 0===e&&(e=[UI.BaseLayer,UI.MainUILayer,UI.MenuUILayer,UI.DlgUILayer,UI.MsgUILayer,UI.GuideUILayer,UI.TopUILayer]);for(var t=this,n=new UI.EUILayer,r=0,o=e.length;o>r;r++){var a=e[r],i=new a;i.touchThrough=!0,t.layerMap[i.layerName]=i,t.uiStackMap[i.layerName]=[],i instanceof UI.BaseLayer?t.addChildAt(i,0):n.addChild(i)}t.addChildAt(n,1)},n.prototype.onEnter=function(){var e=this;e.visible=!0,e.touchEnabled=!0,console.log(e.key+"->enter")},n.prototype.onUpdate=function(){},n.prototype.onExit=function(){var e=this;e.visible=!1,e.touchEnabled=!1,console.log(e.key+"->exit")},n.prototype.onDestroy=function(){var e=this;e.onExit();var t,n;for(var r in e.layerMap){t=e.layerMap[r];for(var o=0,a=t.numElements;a>o;o++)n=t.getElementAt(o),n.onDestroy()}e.layerMap=null,e.uiStackMap=null;var i=e.parent;return i?(i.removeChild(e),void console.log(e.key+"->destroy")):console.warn("场景没有父节点！")},n.prototype.getUISatck=function(e){return this.uiStackMap[e]},n.prototype.add=function(e){var t,n=this;t=e instanceof UI.MainUI?n.layerMap[Consts.LayerNames.MainUILayer]:e instanceof UI.MenuUI?n.layerMap[Consts.LayerNames.MenuUILayer]:e instanceof UI.DlgUILayer?n.layerMap[Consts.LayerNames.DlgUILayer]:e instanceof UI.MsgUI?n.layerMap[Consts.LayerNames.MsgUILayer]:e instanceof UI.GuideUI?n.layerMap[Consts.LayerNames.GuideUILayer]:e instanceof UI.TopUILayer?n.layerMap[Consts.LayerNames.TopUILayer]:n.layerMap[Consts.LayerNames.BaseLayer],n.addToLayer(t,e)},n.prototype.addToLayer=function(e,t){var n=this;e.addChild(t);var r=n.getUISatck(e.layerName);if(r.length){var o=r[r.length-1];o.pause()}r.push(t)},n.prototype.remove=function(e){var t=this,n=e.parent;n&&n.removeChild(e),e=null;var r=t.getUISatck(n.layerName);if(r.pop(),r.length){var o=r[r.length-1];o.resume()}},n.prototype.getTopFromLayer=function(e){var t=this,n=t.getUISatck(e);return n&&n.length?n[n.length-1]:null},n.prototype.closeTopFromLayer=function(e,t){void 0===t&&(t=!0);var n=this,r=n.getTopFromLayer(e);r&&r.close(t)},n}(eui.UILayer);e.SceneBase=t,__reflect(t.prototype,"Scene.SceneBase",["Scene.IScene"])}(Scene||(Scene={}));var Scene;!function(e){var t=function(){function e(){this.sceneMap={}}return Object.defineProperty(e.prototype,"CurScene",{get:function(){var e=this;return e.sceneMap[e.curScene]},enumerable:!0,configurable:!0}),e.prototype.run=function(e,t,n,r,o){void 0===n&&(n={}),void 0===r&&(r=!1),void 0===o&&(o=!0);var a=this,i=a.sceneMap[a.curScene];i&&(o?(i.onDestroy(),delete a.sceneMap[i.key]):i.onExit());var s=a.sceneMap[e];return s||(s=new t(n),Utils.StageUtils.stage.addChild(s),s.key=e,s.onUpdateEnabled=r,a.sceneMap[e]=s),a.curScene=e,s.onEnter(),s},e.prototype.onUpdate=function(){var e=this,t=e.CurScene;t&&t.onUpdateEnabled&&t.onUpdate()},e.prototype.destroyAll=function(){var e=this;if(e.sceneMap){for(var t in e.sceneMap)e.sceneMap[t].onDestroy();e.sceneMap={}}},e}();e.SceneMgr=t,__reflect(t.prototype,"Scene.SceneMgr"),e.sceneMgr=new t}(Scene||(Scene={}));var Tools;!function(e){var t=function(){function e(){var t=this;if(e.instance)throw"KeyInputHandler.instance单例已存在！";document.addEventListener("keydown",function(e){t.keyHandler(e)}),document.addEventListener("keyup",function(e){Utils.StageUtils.stage.dispatchEventWith(e.type),t.curDir=0})}return e.prototype.keyHandler=function(t){var n,r=this;switch(t.keyCode){case 37:case 65:n=e.DIR_LEFT;break;case 39:case 68:n=e.DIR_RIGHT;break;case 38:case 87:n=e.DIR_UP;break;case 83:case 40:n=e.DIR_DOWN;break;default:return}r.curDir!=n&&(r.curDir=n,Utils.StageUtils.stage.dispatchEventWith(t.type,!1,n))},e.instance=new e,e.DIR_LEFT=1,e.DIR_RIGHT=2,e.DIR_UP=3,e.DIR_DOWN=4,e}();e.KeyInputHandler=t,__reflect(t.prototype,"Tools.KeyInputHandler")}(Tools||(Tools={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.SkinUIBase);e.DlgUI=t,__reflect(t.prototype,"UI.DlgUI")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.SkinUIBase);e.GuideUI=t,__reflect(t.prototype,"UI.GuideUI")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.SkinUIBase);e.MainUI=t,__reflect(t.prototype,"UI.MainUI")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.SkinUIBase);e.MenuUI=t,__reflect(t.prototype,"UI.MenuUI")}(UI||(UI={}));var Utils;!function(e){function t(e){return e.__proto__.__class__}function n(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t}function r(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t){setTimeout(t,e)})]})})}e.getClassName=t,e.createBitmapByName=n,e.waitTime=r}(Utils||(Utils={}));var Game;!function(e){var t=function(){function e(){var e=this;egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=e.onUpdate})}return e.prototype.onUpdate=function(){Scene.sceneMgr.onUpdate()},e}();e.GameLoop=t,__reflect(t.prototype,"Game.GameLoop"),e.gameLoop=new t}(Game||(Game={}));var Consts;!function(e){var t;!function(e){e.BaseLayer="BaseLayer",e.MainUILayer="MainUILayer",e.MenuUILayer="MenuUILayer.",e.DlgUILayer="DlgUILayer",e.MsgUILayer="MsgUILayer.",e.GuideUILayer="GuideUILayer",e.TopUILayer="TopUILayer"}(t=e.LayerNames||(e.LayerNames={}))}(Consts||(Consts={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.SkinUIBase);e.TopUI=t,__reflect(t.prototype,"UI.TopUI")}(UI||(UI={}));var UI;!function(e){var t=function(){function e(){}return e.prototype.add=function(e){var t=Scene.sceneMgr.CurScene;t&&t.add(e)},e.prototype.remove=function(e){var t=Scene.sceneMgr.CurScene;t&&t.remove(e)},e.prototype.getTopFromLayer=function(e){var t=Scene.sceneMgr.CurScene;t&&t.getTopFromLayer(e)},e.prototype.closeTopFromLayer=function(e,t){void 0===t&&(t=!0);var n=Scene.sceneMgr.CurScene;n&&n.closeTopFromLayer(e,t)},e}();e.UIManager=t,__reflect(t.prototype,"UI.UIManager"),e.uiManager=new t}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this,n=t;return n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),t}return __extends(t,e),t.prototype.onAddToStage=function(){var e=this;e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.onTouchBegin,e),e.addEventListener(egret.TouchEvent.TOUCH_END,e.onTouchEnd,e),e.addEventListener(egret.TouchEvent.TOUCH_CANCEL,e.onTouchEnd,e),e.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,e.onTouchEnd,e),e.radius=e.tray.width>>1},t.prototype.onTouchBegin=function(e){var t=this;t.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,t.onTouchMove,t)},t.prototype.onTouchMove=function(e){var t=this,n=t.handle.parent.globalToLocal(e.stageX,e.stageY),r=Math.atan2(n.y-t.tray.y,n.x-t.tray.x);n.length>t.radius&&(n=egret.Point.polar(t.radius,r)),t.handle.x=n.x,t.handle.y=n.y,t.curAngle!=r&&(t.curAngle=r,t.stage.dispatchEventWith("onJoystick",!1,r))},t.prototype.onTouchEnd=function(){var e=this;egret.Tween.removeTweens(e.handle),egret.Tween.get(e.handle).to({x:0,y:0},100,egret.Ease.backOut),e.stage.dispatchEventWith("onJoystickEnd"),e.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,e.onTouchMove,e)},t}(eui.Component);e.Joystick=t,__reflect(t.prototype,"UI.Joystick")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.layerName=Consts.LayerNames.BaseLayer,t}return __extends(t,e),t}(egret.DisplayObjectContainer);e.BaseLayer=t,__reflect(t.prototype,"UI.BaseLayer",["UI.ILayer"])}(UI||(UI={}));var UI;!function(e){var t=eui.UILayer,n=function(e){function t(){var t=e.call(this)||this;return t.layerName=Consts.LayerNames.DlgUILayer,t}return __extends(t,e),t}(t);e.DlgUILayer=n,__reflect(n.prototype,"UI.DlgUILayer",["UI.ILayer"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(eui.UILayer);e.EUILayer=t,__reflect(t.prototype,"UI.EUILayer")}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.layerName=Consts.LayerNames.GuideUILayer,t}return __extends(t,e),t}(eui.UILayer);e.GuideUILayer=t,__reflect(t.prototype,"UI.GuideUILayer",["UI.ILayer"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.layerName=Consts.LayerNames.MainUILayer,t}return __extends(t,e),t}(eui.UILayer);e.MainUILayer=t,__reflect(t.prototype,"UI.MainUILayer",["UI.ILayer"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.layerName=Consts.LayerNames.MenuUILayer,t}return __extends(t,e),t}(eui.UILayer);e.MenuUILayer=t,__reflect(t.prototype,"UI.MenuUILayer",["UI.ILayer"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.layerName=Consts.LayerNames.MsgUILayer,t}return __extends(t,e),t}(eui.UILayer);e.MsgUILayer=t,__reflect(t.prototype,"UI.MsgUILayer",["UI.ILayer"])}(UI||(UI={}));var UI;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.layerName=Consts.LayerNames.TopUILayer,t}return __extends(t,e),t}(eui.UILayer);e.TopUILayer=t,__reflect(t.prototype,"UI.TopUILayer",["UI.ILayer"])}(UI||(UI={}));var GameScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onCreate=function(){},t.prototype.onDestroy=function(){},t.prototype.onEnterFrame=function(e){},t.key="gamescene",t}(GameObject);__reflect(GameScene.prototype,"GameScene");var Utils;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t,"stage",{get:function(){return egret.MainContext.instance.stage},enumerable:!0,configurable:!0}),Object.defineProperty(t,"stageWidth",{get:function(){return t.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t,"stageHeight",{get:function(){return t.stage.stageHeight},enumerable:!0,configurable:!0}),t}(SingletonClass);e.StageUtils=t,__reflect(t.prototype,"Utils.StageUtils",["ISingleton"])}(Utils||(Utils={}));var App;!function(e){var t=function(){function e(){}return e}();e.Game=t,__reflect(t.prototype,"App.Game")}(App||(App={}));